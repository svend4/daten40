# NEXT-18 — Evidence Retention & WORM Logs

**Block ID:** NEXT-18  
**Название:** Evidence Retention & WORM (Write-Once-Read-Many) Logs  
**Дата:** 2026-01-13  
**Статус:** draft

## 1) Назначение
Блок обеспечивает **неизменяемое хранение доказательств (evidence)** и аудит-логов: ретеншн (retention), WORM-режим, legal hold, цепочку доказуемой неизменяемости (tamper-evidence) и экспорт пакетов доказательств для внешнего аудита.

Это “фундамент” для:
- комплаенс-отчётов (SOC2/ISO/PCI/HIPAA и т.п.)
- доказуемости “что было сделано” и “когда”
- безопасного шаринга с аудиторами (NEXT-17)

## 2) Что входит (артефакты)
Обязательные:
- `README_20260113.md`
- `spec_20260113.md`
- `manifest_20260113.json`
- `checksums_20260113.json`

Опциональные (позже):
- `schema_20260113.json` (схемы сущностей evidence)
- `openapi_20260113.yaml` (API ретеншн/экспорт/hold)
- `pack_files_20260113/…` (распакованный пакет с кодом/скелетами)

## 3) Входы/выходы
**Входы:**
- события создания/обновления evidence (из Report Builder, Collectors, Evidence Registry)
- политики ретеншн/комплаенса (policy engine)
- запросы “legal hold” (юрист/аудит)
- события инцидентов/релизов (для фиксации состояния)

**Выходы:**
- неизменяемые WORM-записи (append-only)
- “evidence snapshots” по датам
- экспортируемые пакеты доказательств (для auditor portal)
- отчёт о свежести/полноте доказательств (позже)

## 4) Границы и ответственность
**Делает:**
- WORM-append журнала событий и “ссылок на артефакты”
- применение retention policy (удержание/удаление по срокам — где разрешено)
- legal hold (заморозка удаления)
- контроль целостности: hash-chain / signed digests (дизайн)

**Не делает:**
- не собирает evidence сам (это collectors)
- не строит комплаенс-отчёт (это report builder)
- не управляет доступом к порталу аудитора (это NEXT-17)

## 5) Зависимости
- KMS/Secrets (для подписей/ключей)
- Object Storage (S3/GCS/Azure) или WORM-хранилище
- IAM/Org/Workspaces (кто может ставить hold)
- Policy Engine (источник правил ретеншна)

## 6) UX сценарии (минимум 3)
1) **Админ** задаёт ретеншн-политику для типа доказательств “Access Logs” на 7 лет.
2) **Аудитор** запрашивает пакет доказательств на период Q4; система создаёт snapshot и экспорт.
3) **Юрист/комплаенс** ставит legal hold на workspace до завершения расследования.

## 7) Данные и схемы (кратко)
- EvidenceArtifact (ссылка на объект, тип, метаданные)
- EvidenceEvent (append-only запись в журнале)
- RetentionPolicy (rules + scope)
- LegalHold (scope + reason + dates)

Подробности — в `spec_20260113.md`.

## 8) Безопасность и комплаенс
- неизменяемость: WORM / object lock / append-only DB
- целостность: hash-chain + (опционально) подписи ключом KMS
- разграничение доступа: admin/compliance roles
- аудит: все операции policy/hold фиксируются в журнале

## 9) Наблюдаемость
- метрики: lag записи, объём, ошибки записи/проверок, попытки удаления под hold
- алерты: сбой WORM, нарушение ретеншна, невозможность экспортировать snapshot

## 10) План релиза
- P0: модель данных + append-only журнал + policy/hold (без реального удаления, только симуляция)
- P1: WORM sink adapters (S3 Object Lock / immudb / QLDB)
- P2: подписи, attestations, интеграция с auditor portal, отчёты свежести

## 11) TODO / Next
- формализовать интерфейс “WORM Sink” (adapter contract)
- протокол экспорта snapshot (bundle manifest)
- доказуемая цепочка hash-chain + подписи (ключи, ротация)
